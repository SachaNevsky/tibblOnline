import{w as F,a as m,p as n}from"./chunk-EPOLDU6W-Wp3N_t67.js";function _({}){return[{title:"TIBBL Online"},{name:"description",content:"TIBBL tangible programming online"}]}function I(){return[{rel:"icon",href:"/tibblOnline/favicon.ico",type:"image/ico"}]}const x="https://raw.githubusercontent.com/armbennett/tangible-11ty/main",M=[["play","playx","loop","endloop"],["thread1","thread2","thread3","delay"],["variable","random","add","subtract"],["if","else","endif"],["function","endfunction","functioncall"]],h={add:{name:"X = X + 1",command:"x = x + 1",rotatable:!1},subtract:{name:"X = X - 1",command:"x = x - 1",rotatable:!1},delay:{name:"Delay",command:"delay",rotatable:!0,rotationValues:["1","2","3","4","5","6","7","8"]},else:{name:"Else",command:"else",rotatable:!1},endfunction:{name:"End Function",command:"end function",rotatable:!1},endif:{name:"End If",command:"end if",rotatable:!1},endloop:{name:"End Loop",command:"end loop",rotatable:!1},function:{name:"Function",command:"function",rotatable:!1},functioncall:{name:"Call Function",command:"call function",rotatable:!1},if:{name:"If X <",command:"if x <",rotatable:!0,rotationValues:["1","2","3","4","5","6","7","8"]},loop:{name:"Loop",command:"loop",rotatable:!0,rotationValues:["1","2","3","4","5","6","7","8"]},play:{name:"Play",command:"play",rotatable:!0,rotationValues:["1","2","3","4","5","6","7","8"]},playx:{name:"Play X",command:"play x",rotatable:!1},random:{name:"X = Random",command:"x = random",rotatable:!1},thread1:{name:"Thread 1",command:"thread 1",rotatable:!1},thread2:{name:"Thread 2",command:"thread 2",rotatable:!1},thread3:{name:"Thread 3",command:"thread 3",rotatable:!1},variable:{name:"X =",command:"x =",rotatable:!0,rotationValues:["1","2","3","4","5","6","7","8"]}},j=[{value:"MusicLoops1",label:"Music Loops 1"},{value:"Mystery",label:"Mystery"},{value:"Numbers",label:"Numbers"},{value:"Notifications",label:"Notifications"},{value:"OdeToJoy",label:"Ode to Joy"},{value:"FurElise",label:"FÃ¼r Elise"}],U=F(function(){const[c,p]=m.useState(Array(7).fill(null).map(()=>Array(5).fill(null))),[i,y]=m.useState(null),[r,T]=m.useState(null),[S,C]=m.useState(!0),[$,f]=m.useState(!1),[w,g]=m.useState(["","",""]),[u,D]=m.useState(["Numbers","Mystery","Notifications"]);m.useEffect(()=>{(async()=>{try{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js",document.head.appendChild(t),await new Promise(d=>{t.onload=()=>d()});const s=(await(await fetch(`${x}/assets/js/tangible.js`)).text()).replace("export default class Tangible","window.Tangible = class Tangible"),o=document.createElement("script");o.textContent=s,document.head.appendChild(o),C(!1)}catch(t){console.error("Error loading scripts:",t)}})()},[]);const N=(e,t,a=!1,l)=>{y({type:t,fromGrid:a,gridPos:l}),e.dataTransfer.effectAllowed="copy"},E=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},P=(e,t,a)=>{if(e.preventDefault(),e.stopPropagation(),i){const l=c.map(s=>[...s]);if(i.fromGrid&&i.gridPos){const s=c[i.gridPos.row][i.gridPos.col];l[i.gridPos.row][i.gridPos.col]=null,l[t][a]=s}else l[t][a]={type:i.type,rotation:0};p(l),y(null)}},O=e=>{if(e.preventDefault(),e.stopPropagation(),i&&i.fromGrid&&i.gridPos){const t=c.map(a=>[...a]);t[i.gridPos.row][i.gridPos.col]=null,p(t),y(null)}},L=(e,t)=>{const a=c[e][t];if(a&&h[a.type].rotatable){const l=c.map(o=>[...o]),s=h[a.type].rotationValues?.length||8;l[e][t]={...a,rotation:(a.rotation+1)%s},p(l)}},G=e=>{const t=h[e.type];if(!t.rotatable)return t.name;const a=t.rotationValues?.[e.rotation]||"1";switch(e.type){case"play":return`Play ${a}`;case"loop":return`Loop ${a} Times`;case"delay":return`Delay ${a}`;case"variable":return`X = ${a}`;case"if":return`If X < ${a}`;default:return t.name}},R=e=>{const t=h[e.type];if(!t.rotatable)return t.command;const a=t.rotationValues?.[e.rotation]||"1";switch(e.type){case"play":return`play ${a}`;case"loop":return`loop ${a} times`;case"delay":return`delay ${a}`;case"variable":return`x = ${a}`;case"if":return`if x < ${a}`;default:return t.command}},V=()=>{const e=[[],[],[]];let t=0;for(let a=0;a<c.length;a++)for(let l=0;l<c[a].length;l++){const s=c[a][l];if(s){const o=R(s);s.type==="thread1"?t=0:s.type==="thread2"?t=1:s.type==="thread3"&&(t=2),e[t].push(o)}}return e},b=(e,t,a)=>{const l=new window.Howl({src:[`${x}/assets/sound/${t}.mp3`],volume:.2,sprite:e.soundSets[t]});e.threads[a]=l},v=(e,t)=>{const a=[...u];a[e]=t,D(a),r&&b(r,t,e)},X=()=>{if(window.Tangible)try{const e=V();if(!e.some(a=>a.length>0)){g(["","",""]);return}if(f(!0),g(e.map(a=>a.join(`
`))),r){const a=e.flat().join(`
`),l=r.parseTextAsJavascript(a);r.evalTile(l,r);let s=0;for(let o=0;o<r.codeThreads.length;o++)r.codeThreads[o].length>0&&(r.playStart(r.threads[o],r.codeThreads[o]),s=Math.max(s,r.codeThreads[o].length));setTimeout(()=>{f(!1)},s*1e3)}else{const a=new window.Tangible;b(a,u[0],0),b(a,u[1],1),b(a,u[2],2),T(a),setTimeout(()=>{const l=e.flat().join(`
`),s=a.parseTextAsJavascript(l);a.evalTile(s,a);let o=0;for(let d=0;d<a.codeThreads.length;d++)a.codeThreads[d].length>0&&(a.playStart(a.threads[d],a.codeThreads[d]),o=Math.max(o,a.codeThreads[d].length));setTimeout(()=>{f(!1)},o*1e3)},500)}}catch(e){g([`Error: ${e.message}`,"",""]),f(!1),console.error(e)}},A=()=>{if(r){for(let e=0;e<r.threads.length;e++){const t=r.threads[e];t&&t.stop()}r.codeThreads=[[],[],[]],f(!1)}},B=()=>{p(Array(7).fill(null).map(()=>Array(5).fill(null))),g(["","",""]),f(!1)};if(S)return n.jsx("div",{className:"min-h-screen bg-gray-900 text-white flex items-center justify-center",children:n.jsx("div",{className:"text-xl",children:"Loading TIBBL system..."})});const k=w.some(e=>e.length>0);return n.jsx("div",{className:"min-h-screen bg-gray-900 text-white p-8 flex items-center justify-center",children:n.jsxs("div",{className:"w-full h-[90vh] flex flex-col",children:[n.jsxs("div",{className:"grid grid-cols-4 items-center mb-6 shrink-0 gap-8",children:[n.jsxs("h1",{className:"inline-flex items-center gap-2 text-4xl font-bold",children:[n.jsx("img",{src:"tibbl-logo.png",alt:"Tibbl logo",className:"h-[1em] w-auto"}),"Online"]}),n.jsxs("div",{className:"col-start-4 flex items-center gap-4 w-full",children:[n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx("label",{className:"text-white font-bold mb-1",children:"Thread 1:"}),n.jsx("select",{value:u[0],onChange:e=>v(0,e.target.value),className:"bg-gray-800 text-white px-3 py-1 rounded border border-gray-700 focus:outline-none focus:border-blue-500",children:j.map(e=>n.jsx("option",{value:e.value,children:e.label},e.value))})]}),n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx("label",{className:"text-white font-bold mb-1",children:"Thread 2:"}),n.jsx("select",{value:u[1],onChange:e=>v(1,e.target.value),className:"bg-gray-800 text-white px-3 py-1 rounded border border-gray-700 focus:outline-none focus:border-blue-500",children:j.map(e=>n.jsx("option",{value:e.value,children:e.label},e.value))})]}),n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx("label",{className:"text-white font-bold mb-1",children:"Thread 3:"}),n.jsx("select",{value:u[2],onChange:e=>v(2,e.target.value),className:"bg-gray-800 text-white px-3 py-1 rounded border border-gray-700 focus:outline-none focus:border-blue-500",children:j.map(e=>n.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 flex-1 min-h-0",children:[n.jsx("div",{className:"lg:col-span-1 flex flex-col min-h-0",children:n.jsx("div",{className:"bg-gray-800 p-4 rounded-lg space-y-3 overflow-auto h-full",onDrop:O,onDragOver:e=>e.preventDefault(),children:M.map((e,t)=>n.jsx("div",{className:"grid gap-3",style:{gridTemplateColumns:`repeat(${e.length}, minmax(0, 1fr))`},children:e.map(a=>n.jsxs("div",{draggable:!0,onDragStart:l=>N(l,a),className:"cursor-grab active:cursor-grabbing bg-gray-700 rounded p-2 hover:bg-gray-600 transition select-none",children:[n.jsx("img",{src:`${x}/assets/demo-files/tiles/${a}.png`,alt:a,className:"w-full h-auto mb-1 pointer-events-none"}),n.jsx("div",{className:"text-xs sm:text-xs text-center text-gray-300",children:h[a].name})]},a))},t))})}),n.jsx("div",{className:"lg:col-span-2 flex flex-col min-h-0",children:n.jsx("div",{className:"bg-gray-800 p-4 rounded-lg h-full flex items-center justify-center",children:n.jsx("div",{className:"grid grid-cols-5 gap-2 h-full w-auto",style:{aspectRatio:"5/7"},children:c.map((e,t)=>e.map((a,l)=>n.jsx("div",{onDragOver:E,onDrop:s=>P(s,t,l),onClick:()=>a&&L(t,l),className:`border-2 border-dashed rounded flex flex-col items-center justify-center aspect-square ${a?`border-green-500 bg-gray-700 ${h[a.type].rotatable?"cursor-pointer hover:bg-gray-600":"cursor-move"}`:"border-gray-600 bg-gray-750"}`,children:a&&n.jsx(n.Fragment,{children:n.jsxs("div",{className:"w-full h-full flex items-center justify-center p-1 select-none flex-col",draggable:!0,onDragStart:s=>{s.stopPropagation(),N(s,a.type,!0,{row:t,col:l})},children:[n.jsx("img",{src:`${x}/assets/demo-files/tiles/${a.type}.png`,alt:a.type,className:"w-full h-full object-contain pointer-events-none"}),n.jsx("div",{className:"text-xs sm:text-xs text-center text-gray-300",children:G(a)})]})})},`${t}-${l}`)))})})}),n.jsxs("div",{className:"lg:col-span-1 flex flex-col min-h-0",children:[n.jsxs("div",{className:"flex flex-col gap-2 mb-4 shrink-0",children:[n.jsx("button",{onClick:X,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded transition font-semibold",children:"Run Code"}),n.jsx("button",{onClick:A,className:"w-full px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded transition font-semibold",children:"Stop"}),n.jsx("button",{onClick:B,className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition",children:"Clear Grid"})]}),k?n.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg flex-1 overflow-auto min-h-0",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("h3",{className:"text-xl font-semibold",children:"Code:"}),$&&n.jsx("span",{className:"text-sm text-green-400 font-semibold",children:"Running..."})]}),w.map((e,t)=>n.jsx("div",{className:"pb-4",children:e&&n.jsx("pre",{className:"text-sm text-gray-300 whitespace-pre-wrap font-mono",children:e})},t))]}):n.jsx("div",{className:"bg-gray-800 p-4 rounded-lg flex-1 overflow-auto min-h-0"})]})]})]})})});export{U as default,I as links,_ as meta};
